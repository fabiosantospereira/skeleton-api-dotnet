USE [master]
GO

IF DB_ID('{{DB_DATABASE}}') IS NOT NULL
  set noexec on 

CREATE DATABASE [{{DB_DATABASE}}];
GO

USE [{{DB_DATABASE}}]
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE LOGIN [{{DB_USER}}] WITH PASSWORD = '{{DB_PASSWORD}}'
GO

CREATE USER [{{DB_USER}}] FOR LOGIN [{{DB_USER}}]
GO

GRANT SELECT ON SCHEMA::dbo TO [{{DB_USER}}];
GO

GRANT INSERT ON SCHEMA::dbo TO [{{DB_USER}}];
GO

GRANT UPDATE ON SCHEMA::dbo TO [{{DB_USER}}];
GO

GRANT DELETE ON SCHEMA::dbo TO [{{DB_USER}}];
GO

IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'MigrationHistory')
BEGIN
    CREATE TABLE MigrationHistory (
        Id INT PRIMARY KEY IDENTITY(1,1),
        MigrationId NVARCHAR(255) NOT NULL,
        AppliedOn DATETIME NOT NULL
    );
END;